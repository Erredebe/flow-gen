<section class="panel">
  <h2>Debug de ejecuciones</h2>
  <p>Inspecciona eventos y snapshot final por <code>runId</code>.</p>

  <div class="actions">
    <label>
      Run ID
      <input type="text" [ngModel]="runId()" (ngModelChange)="onRunIdChange($event)" placeholder="run-123" />
    </label>
    <button type="button" class="btn" (click)="loadTrace()">Buscar trazas</button>
  </div>

  @if (availableRunIds().length > 0) {
    <label>
      Runs disponibles
      <select (change)="onRunSelected($any($event.target).value)">
        <option value="">Seleccionar…</option>
        @for (item of availableRunIds(); track item) {
          <option [value]="item">{{ item }}</option>
        }
      </select>
    </label>
  }

  @if (error(); as message) {
    <p class="message error">{{ message }}</p>
  }

  @if (events().length > 0) {
    <h3>Eventos ({{ events().length }})</h3>
    <ol class="events">
      @for (event of events(); track event.sequence) {
        <li>
          <strong>#{{ event.sequence }} · {{ event.type }}</strong>
          <div>nodeId: {{ event.nodeId ?? '—' }}</div>
          <div>at: {{ event.occurredAt }}</div>
          <pre>{{ toJson(event.payload ?? {}) }}</pre>
        </li>
      }
    </ol>
  }

  @if (snapshot(); as runSnapshot) {
    <h3>Snapshot final</h3>
    <pre>{{ toJson(runSnapshot) }}</pre>
  }
</section>
